apiVersion: manta/v1
kind: Dashboard
name: Manta
spec:
  name: Manta
  cells:
    - name: CPU
      x: 0
      y: 0
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            suffix: "%"
            base: ''
        queries:
          - text: 100 * rate(process_cpu_seconds_total[1m])
        xColumn: time
        yColumn: value
    - name: Memory
      x: 4
      y: 0
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: '2'
        queries:
          - text: process_resident_memory_bytes
        xColumn: time
        yColumn: value
    - name: Goroutines & Threads
      x: 8
      y: 0
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: go_goroutines
          - name: Query 2
            text: go_threads
        xColumn: time
        yColumn: value
    - name: HTTP requests
      x: 0
      y: 4
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: sum(rate(manta_http_request_total[1m])) by (code)
        xColumn: time
        yColumn: value
        hoverDimension: auto
    - name: Update latency
      x: 4
      y: 4
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            suffix: s
            base: '2'
        queries:
          - text: histogram_quantile(0.9, rate(manta_boltdb_update_duration_seconds_bucket[1m]))
        xColumn: time
        yColumn: value
    - name: Head searies
      x: 8
      y: 4
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: prometheus_tsdb_head_series
        xColumn: time
        yColumn: value
    - name: BoltDB read
      x: 4
      y: 8
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: rate(boltdb_reads_total[1m])
        xColumn: time
        yColumn: value
    - name: BoltDB writes
      x: 0
      y: 8
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: rate(boltdb_writes_total[1m])
        xColumn: time
        yColumn: value
    - name: ALERTS
      x: 8
      y: 8
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: ALERTS
        xColumn: time
        yColumn: value
        hoverDimension: auto
    - name: Active alert
      x: 0
      y: 12
      w: 4
      h: 4
      viewProperties:
        type: xy
        axes:
          x:
            base: ''
          y:
            base: ''
        queries:
          - text: count(ALERTS_FOR_STATE > 0)
        xColumn: time
        yColumn: value
        hoverDimension: x
---
apiVersion: manta/v1
kind: Scraper
name: Selfstat
spec:
  name: Selfstat
  desc: collect metrics from manta itself
  targets:
    - 127.0.0.1:8088
  labels:
    foo: bar